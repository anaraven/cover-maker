<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://unpkg.com/tachyons@4.10.0/css/tachyons.min.css"/>
  <link rel="stylesheet" href="cover.css">
  <title>Cover</title>
</head>
<body>
<div class="all" id="todo">
  <div class="face" id="back" onclick="showBlock(this)" data-dst="back-tab">
  </div>
  <div class="center" id="title" onclick="showBlock(this)" data-dst="center-tab"
	style="width: 20mm;">
    Title of the book
  </div>
  <div class="face" id="front" onclick="showBlock(this)" data-dst="front-tab">
  </div>
</div>
<div class="data">
<fieldset class="col measure" id="back-tab">
<legend class="f4 ph1">Back</legend>
<div class="mt1">
<label class="db fw6 lh-copy f6" for="back_file">Image</label>
<input type="file" id="back_file" name="files[]" onchange="handleFileSelect(this)" data-dst="back" /></div>
<div class="mv1"><label class="db fw6 lh-copy f6" for="back_file">Background</label>
<input type="color" id="back_bg" value="#ffffff" onchange="changeAttribute(this)" data-dst="back" data-attr="background"/></div>
</fieldset>
<fieldset class="col measure" id="center-tab">
<legend class="f4 ph1">Center</legend>
<div class="dt dt--fixed"><div class="dtc">
<div><label class="db fw6 lh-copy f6" for="back_file">Text</label>
<input type="text" value="Title of the Book" onchange="updateTitle(this)" data-dst="title"></div>
<div><label class="db fw6 lh-copy f6" for="back_file">Background</label>
<input type="color" value="#ffffff" onchange="changeAttribute(this)" data-dst="title" data-attr="background"/></div>
<div><label class="db fw6 lh-copy f6" for="back_file"> Foreground</label>
<input type="color" value="#000000" onchange="changeAttribute(this)" data-dst="title" data-attr="color"/></div>
<div><label class="db fw6 lh-copy f6" for="back_file"> Width</label>
<input type="text" value="20mm" onchange="changeAttribute(this)" data-dst="title" data-attr="width"/></div>
</div>
<div class="dtc">
<div><label class="db fw6 lh-copy f6" for="back_file"> Line Size</label>
<input type="text" value="20mm" onchange="changeAttribute(this)" data-dst="title" data-attr="line-height"/></div>
<div><label class="db fw6 lh-copy f6" for="back_file"> Font Size</label>
<input type="text" value="15mm" onchange="changeAttribute(this)" data-dst="title" data-attr="font-size"/></div>
<div><label class="db fw6 lh-copy f6" for="back_file"> Font</label>
  <select class="f6" id="selectFontFamily" name="selectFontFamily" onchange="updateFontfamily(this)">
    <option> Serif </option>
    <option> Sans-Serif </option>
    <option> Monospace </option>
    <option> Tahoma </option>
    <option> Verdana </option>
    <option> Lucida Sans Unicode </option>
<option style="font-family: Arial">Arial</option>
<option style="font-family: Arial Black">Arial Black</option>
<option style="font-family: Calibri">Calibri</option>
<option style="font-family: Comic Sans MS">Comic Sans MS</option>
<option style="font-family: Courier new">courier new</option>
<option style="font-family: Impact">Impact</option>
<option style="font-family: Libre Baskerville">Libre Baskerville</option>
<option style="font-family: Martel Sans">Martel Sans</option>
<option style="font-family: Unifraktur Cook">Unifraktur Cook</option>
    <option> Other ...</option>
</select>
</div>
<div><label class="db fw6 lh-copy f6" for="back_file"><a href="https://wordmark.it/" target="_blank">Other font</a></label>
<input id="other_font" type="text" value="" onchange="loadFont(this)"/></div>
</div>
</div>
</fieldset>
<fieldset class="col measure" id="front-tab">
<legend class="f4 ph1">Front</legend>
<div><label class="db fw6 lh-copy f6" for="front_file"> Image</label>
<input type="file" id="front_file" data-dst="front" name="files[]" onchange="handleFileSelect(this)"/></div>
<div><label class="db fw6 lh-copy f6" for="back_file"> Background</label>
<input type="color" value="#ffffff" onchange="changeAttribute(this)" data-dst="front" data-attr="background" /></div>
<div><label class="db fw6 lh-copy f6" for="back_file"> Width</label>
<input type="text" value="100mm" onchange="changeAttribute(this)" data-dst="front" data-attr="width"/></div>
<div><label class="db fw6 lh-copy f6" for="back_file"> Height</label>
<input type="text" value="131mm" onchange="changeAttribute(this)" data-dst="todo" data-attr="height"/></div>
</fieldset>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>
<script>
// TODO: update back width
var back  = document.getElementById('back');
var title = document.getElementById('title');
var front = document.getElementById('front');

// handle file selection. Update image
function handleFileSelect(tgt) {
  var dst = tgt.dataset.dst
  var files = tgt.files; // FileList object

  for (var i = 0, f; f = files[i]; i++) {
    // Only process image files.
    if (!f.type.match('image.*')) {
      continue;
    }
    var reader = new FileReader();

    // Closure to capture the file information.
    reader.onload = (function(theFile) {
      return function(e) {
        var span = document.getElementById(dst);
        span.innerHTML = ['<img src="', e.target.result,
                          '" title="', escape(theFile.name), '"/>'].join('');
      };
    })(f);
    reader.readAsDataURL(f);
  }
}

function loadFont(tgt) {
  var selector = document.getElementById("selectFontFamily");
  var family = selector.options[selector.selectedIndex].value;
  var fontName = tgt.value;
  console.log(fontName);
  if(fontName !="") {
    WebFont.load({ google: { families: [fontName] } });
    title.style.fontFamily = fontName;
  }
}

function changeAttribute(tgt) {
  var dst = tgt.dataset.dst
  var attr = tgt.dataset.attr
  var col = tgt.value;
  console.log(dst, attr, col)
  var doc = document.getElementById(dst);
  doc.style[attr] = col;
}

function updateFontfamily(selector) {
  var family = selector.options[selector.selectedIndex].value;
	console.log(family);
  if(family==="Other ...") {
     fontName = document.getElementById("other_font").value
	console.log(fontName);
     if(fontName != "") {
	  console.log(WebFont.load({ google: { families: [fontName] } }));
	  title.style.fontFamily = fontName;
     }
  } else {
	title.style.fontFamily = family;
  }
}

function updateTitle(tgt) {
  title.innerHTML = tgt.value;
}

function showBlock(tgt) {
  var dst = tgt.dataset.dst
  var doc = document.getElementById(dst);
  document.getElementById('back-tab').style["display"] = "none";
  document.getElementById('center-tab').style["display"] = "none";
  document.getElementById('front-tab').style["display"] = "none";
  doc.style["display"] = "block";
}

// “Update details” button opens the <dialog> modally
</script>
</body>
</html>
